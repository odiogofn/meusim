<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Consulta SIM</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    nav { margin-bottom: 20px; }
    nav button { margin-right: 10px; }
    section { display: none; }
    section.active { display: block; }
    label { display: block; margin: 10px 0 5px; }
  </style>
</head>
<body>
  <h1>Portal SIM</h1>

  <!-- Navegação -->
  <nav>
    <button onclick="abrirAba('consulta')">Consulta</button>
    <button onclick="abrirAba('config')">Configuração</button>
  </nav>

  <!-- Aba Consulta -->
  <section id="consulta" class="active">
    <h2>Consulta de SIM</h2>
    <label for="simInput">Digite o número do SIM:</label>
    <input type="text" id="simInput" placeholder="Ex: 123456">
    
    <label for="ano">Ano:</label>
    <select id="ano"></select>

    <label for="mes">Mês:</label>
    <select id="mes">
      <option value="01">Janeiro</option>
      <option value="02">Fevereiro</option>
      <option value="03">Março</option>
      <option value="04">Abril</option>
      <option value="05">Maio</option>
      <option value="06">Junho</option>
      <option value="07">Julho</option>
      <option value="08">Agosto</option>
      <option value="09">Setembro</option>
      <option value="10">Outubro</option>
      <option value="11">Novembro</option>
      <option value="12">Dezembro</option>
    </select>

    <br><br>
    <button onclick="consultarSIM()">Consultar</button>
    <pre id="resultado"></pre>
  </section>

  <!-- Aba Configuração -->
  <section id="config">
    <h2>Configuração</h2>
    <p>Ambiente de teste: conectado ao Supabase via Vercel.</p>
    <p>Região: Brasil (gru1)</p>
    <p>Limite API: 500 req/s</p>
  </section>

  <script>
    // Alterna abas
    function abrirAba(id) {
      document.querySelectorAll("section").forEach(sec => sec.classList.remove("active"));
      document.getElementById(id).classList.add("active");
    }

    // Popula anos (2025 até 2000)
    const anoSelect = document.getElementById("ano");
    for (let y = 2025; y >= 2000; y--) {
      const opt = document.createElement("option");
      opt.value = y;
      opt.textContent = y;
      anoSelect.appendChild(opt);
    }

    // Chama API
    async function consultarSIM() {
      const sim = document.getElementById("simInput").value.trim();
      const ano = document.getElementById("ano").value;
      const mes = document.getElementById("mes").value;
      const resultado = document.getElementById("resultado");

      if (!sim) {
        resultado.textContent = "Digite um número válido.";
        return;
      }

      try {
        const res = await fetch(`/api/extracao?sim=${encodeURIComponent(sim)}&ano=${ano}&mes=${mes}`);
        const data = await res.json();

        if (res.ok) {
          resultado.textContent = JSON.stringify(data, null, 2);
        } else {
          resultado.textContent = "Erro: " + (data.error || "Erro desconhecido");
        }
      } catch (err) {
        resultado.textContent = "Erro na requisição: " + err.message;
      }
    }
  </script>
</body>
</html>
